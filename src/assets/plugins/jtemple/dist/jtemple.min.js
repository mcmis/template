/* jtemple - A template engine */

/*
 * Author: Farhan Wazir
 * Email: farhan.wazir@gmail.com
 * Website: http://github.com/farhanwazir/jtemple
 *
 ************ Objective ***********
 * This piece of code is to achieve small task in few lines.
 *
 *
 ************ Description: ***********
 * I was working on one project where i need javascript based template engine but unfortunately
 * available open source template engines are not fulfilling my need but these are not for widgets
 * or small pieces of html codes. Available engines good for use if you are start with them but not
 * for developed applications.
 *
 *
 ************ LICENSE ***********
 * The MIT License (MIT)
 * Copyright (c) 2016 Farhan Wazir
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
 * associated documentation files (the "Software"), to deal in the Software without restriction,
 * including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 * The above copyright notice and this permission notice shall be included in all copies or substantial
 * portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT
 * LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN
 * NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * */
!function(a,b){function d(d,e){var f=a.extend({},a.fn[c].defaults,e);this.target=d;var g="\n",h=!1,i=!1,j="jtemple_output";f.target!==!1&&(this.target=a(f.target));var l=function(){return lines=a(f.template).html().split("\n"),output="var "+j+"='';\n",a.each(lines,function(a,b){output+=n(b,a,lines.length)}),output=m(output),output},m=function(a){var b=/\{#[\s]*(.+\S)[\s]*#}/;return a.match(b)instanceof Array&&(a=a.replace(/{#/g,f.syntax.quote+"+").replace(/#}/g,"+"+f.syntax.quote)),a},n=function(b,c,d){for(var e=[/(#for[\s]*\([\s]*)(.+\S)([\s]*\)[\s]*;)/,/(#foreach[\s]*\([\s]*)(.+\S)([\s]*\)[\s]*;)/,/(#if[\s]*\([\s]*)(.+\S)([\s]*\)[\s]*;)/],k=[/(#endfor[\s]*;)/,/(#endforeach[\s]*;)/,/(#endif[\s]*;)/],l=["for(#{statement}#){ \n","foreach(#{statement}#){ \n","if(#{statement}#){ \n"],m="\n}\n",n=new RegExp(f.syntax.quote,"g"),o=a.trim(b).replace(n,'\\"'),p=0;p<e.length;p++){var q=b.match(e[p]);if(q instanceof Array){h?(o=f.syntax.quote+";",h=!1):o="",o+=b.replace(e[p],l[p].replace("#{statement}#",q[2].replace("&lt;","<").replace("&gt;",">"))),i=!0;break}}i&&!h&&(o+=g+j+"+="+f.syntax.quote,h=!0);for(var p=0;p<k.length;p++){var q=b.match(k[p]);if(q instanceof Array){h?(o=f.syntax.quote+";",h=!1):o="",o+=b.replace(k[p],m),i=!1;break}}return c==d-1?(h&&(o+=f.syntax.quote+";",h=!1),i&&(o+=m,i=!1)):i||h||(o+=j+"+="+f.syntax.quote,h=!0),o},o=function(c){return this.data=c,a.globalEval(l()),b[j]},p=function(b){switch(f.publish){case"append":a(b).append(o(f.data));break;case"prepend":a(b).prepend(o(f.data));break;default:a(b).html(o(f.data))}};return p(this.target),this}var c="jtemple";a.fn[c]=function(a){return this.each(function(){new d(this,a)})},a.fn[c].defaults={template:"tmpl",data:[],syntax:{quote:'"'},target:!1,publish:"replace"}}(jQuery,window);